---
import Layout from "../../layouts/Layout.astro";
import LinkPersonne from "../../components/LinkPersonne.astro";
import { formatDate } from "../../utilitaires";

const { id } = Astro.params;

if (!id) {
    return Astro.redirect("/film");
}

const film = await Astro.locals.pb.collection("Films").getOne(id, {
    expand: "personnes"
});

const acteurs = film.expand?.personnes ?? [];
---
<Layout title={film.titre ?? 'Film'}>
    <article>
        <header class="mb-6">
            <h1>{film.titre}</h1>
            {film.sortie && (
                <p class="text-gray-600">Sorti le {formatDate(film.sortie)}</p>
            )}
        </header>

        <div class="space-y-4">
            {film.duree && (
                <p>
                    <span class="font-medium">Durée :</span> {film.duree} minutes
                </p>
            )}
            {film.synopsis && (
                <div>
                    <h2>Synopsis</h2>
                    <p class="text-gray-700 leading-relaxed">{film.synopsis}</p>
                </div>
            )}

            {acteurs.length > 0 && (
                <div>
                    <h2>Casting</h2>
                    <ul class="list-disc list-inside">
                        {acteurs.map((personne) => (
                            <li>
                                <LinkPersonne personne={personne} />
                            </li>
                        ))}
                    </ul>
                </div>
            )}
        </div>

        <div class="mt-8 flex gap-4">
            <a href="/film" class="text-gray-600">← Retour à la liste</a>
            {Astro.locals.pb.authStore.record?.id === film.user && (
                <a href={`/film/edit/${film.id}`} class="btn">Modifier</a>
            )}
        </div>
    </article>
</Layout>